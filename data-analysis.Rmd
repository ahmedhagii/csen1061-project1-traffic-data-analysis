---
title: "Traffic Data Analysis"
output: html_document
author: "Ahmed Akram"
---


```{r, message=FALSE}
library(dplyr)
library(ggplot2)
library(knitr)
library(foreach)
```

### Data Processing

We'll load the data and take a look around its different columns and a sample of records.
```{r}
data.raw <- read.csv('traffic-data.csv')
data.raw %>% glimpse
```

we have many features concerning the ads, let's see how many unique ad logos we got, just to make sure the ad features are not relevant to our investigation.

```{r}
data.raw %>% select(ad.logo) %>% unique %>% nrow
```

since there's only one unique logo, then the ad is the same across all the rerports we got. Let's remove all features prefixed with "ad"

```{r}
data.reports <- data.raw %>% select(-(starts_with("ad")))
```


#### keep an eye on this for now
```{r}
sapply(data.reports, function(x) length(unique(x)))
data.reports %>% select(rd.cl) %>% glimpse
```


#### Investigating duplicates

let's try to find if we got any duplicates. A duplicate would occur if we crawled the same data, but at different times. So first I'll ignore the "crawl_date" column and compare using the rest.

```{r}
data.no_date <- data.reports %>% select(-(crawl_date))
```

get all unique reports based only on the comment id, since each comment has a unique id (I suppose .. ?)

```{r}
data.unique_comments_ids <- data.no_date %>% subset(!duplicated(rd.rp.cmid))
data.unique_comments_ids %>% nrow
```

now when I remove all the times features, we already removed the crawl date, but there are those columns telling us when the reprot was posted (posted 2 hours ago), this one will be represented by `rd.rp.hr` and `rd.rp.mn`. Morever there're `rd.hr` and `rd.mn`. I'm still not quite sure what they represent, but most probably the last time the whole line or road was updated. 

I'll remove all those for now and have the data with no times at all. 
```{r}
data.no_times <- data.no_date %>% select(-rd.hr, -rd.mn, -rd.rp.hr, -rd.rp.mn)
```

Now if I were to run this, I expect to have the same number of records that I had in the `data.unique_comments_ids` dataframe.
```{r}
data.no_times %>% unique %>% nrow
```

as you can see that doesn't happen, the later gave us `148367` while this one `209375`. I need to know which records are there with the same comment ids but differ in other columns. Let's investigate this a bit.


```{r}
data.raw %>% count(rd.rp.cmid) %>% subset(n > 1) %>% arrange(-n)
```
grouping the data by the `cmid` and looking at them, shows that each group has a maximum of 4 comments grouped together. The below function just prints some of these groups.

```{r}
fn <- function(data) {
    cm_ids <- data %>% count(rd.rp.cmid) %>% subset(n > 1) %>% arrange(-n) %>% select(rd.rp.cmid)
    cm_ids_arr <- cm_ids$rd.rp.cmid
    for(i in 1:5)
        print(data %>% subset(rd.rp.cmid == cm_ids_arr[i]) %>% select(rd.rp.cm, rd.rp.nm, rd.nm), width=Inf)
}
```

let's execute it:
```{r}
fn(data.no_times %>% unique)
```

the printed data showed that each group of comments will have the same road name, same commenter, same comment text. My conclusion is that these reports were generated by the bey2ollak gps tracking feature, where I can turn it on and have my phone sending reports automatically.  

#### Removing duplicates


